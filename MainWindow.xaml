<Window x:Class="UltimaOnlineMacro.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:model="clr-namespace:AutoClicker.Models.TM;assembly=AutoClicker"
        xmlns:local="clr-namespace:UltimaOnlineMacro.Service" xmlns:fa="http://schemas.fontawesome.io/icons/"
        Title="UltimaOnlineMacro - Rotiniel Tools" Height="660" Width="470"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        AllowsTransparency="False"
        Icon="/UltimaOnlineMacro;component/Assets/Images/icon.ico"      
        WindowStyle="None">

    <Window.Resources>
        <!-- Colori dell'app -->
        <Color x:Key="PrimaryColor">#1E88E5</Color>
        <Color x:Key="PrimaryDarkColor">#0D47A1</Color>
        <Color x:Key="AccentColor">#00C853</Color>
        <Color x:Key="DangerColor">#E53935</Color>
        <Color x:Key="BackgroundDarkColor">#1E1E1E</Color>
        <Color x:Key="BackgroundMediumColor">#2D2D30</Color>
        <Color x:Key="BackgroundLightColor">#3E3E42</Color>
        <Color x:Key="TextPrimaryColor">#FFFFFF</Color>
        <Color x:Key="TextSecondaryColor">#B3B3B3</Color>

        <SolidColorBrush x:Key="PrimaryBrush" Color="{StaticResource PrimaryColor}"/>
        <SolidColorBrush x:Key="PrimaryDarkBrush" Color="{StaticResource PrimaryDarkColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="DangerBrush" Color="{StaticResource DangerColor}"/>
        <SolidColorBrush x:Key="BackgroundDarkBrush" Color="{StaticResource BackgroundDarkColor}"/>
        <SolidColorBrush x:Key="BackgroundMediumBrush" Color="{StaticResource BackgroundMediumColor}"/>
        <SolidColorBrush x:Key="BackgroundLightBrush" Color="{StaticResource BackgroundLightColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>

        <!-- Drop shadow effect -->
        <DropShadowEffect x:Key="StandardShadow" BlurRadius="0" Direction="315" 
                         Opacity="0" ShadowDepth="0" Color="Black"/>

        <!-- Stile pulsanti principali -->
        <Style x:Key="MyButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}" />
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Padding" Value="10,5" />
            <Setter Property="Margin" Value="10" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Height" Value="50" />
            <Setter Property="Width" Value="170" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                BorderBrush="Transparent"
                                BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryDarkBrush}" TargetName="border" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryDarkBrush}" TargetName="border" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#666666" TargetName="border" />
                                <Setter Property="Effect" Value="{x:Null}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Stile per i pulsanti della barra titolo -->
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF555555" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FF333333" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Stile per il pulsante di chiusura della barra titolo -->
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Stile per i campi di input -->
        <Style x:Key="InputStyle" TargetType="Control">
            <Setter Property="Background" Value="#2A2A30" />
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="BorderBrush" Value="#454545" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="5" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}" />
                </Trigger>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Stile per CheckBox -->
        <Style x:Key="ModernCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="checkBoxBorder" 
                                    Width="18" 
                                    Height="18" 
                                    CornerRadius="3" 
                                    BorderThickness="1" 
                                    BorderBrush="#666666" 
                                    Background="Transparent">
                                <Path x:Name="checkMark" 
                                      Stretch="Uniform" 
                                      Width="12" 
                                      Height="12" 
                                      Fill="{StaticResource PrimaryBrush}" 
                                      Data="M0,4 L3,7 8,0" 
                                      StrokeThickness="2" 
                                      Stroke="{StaticResource PrimaryBrush}" 
                                      Visibility="Collapsed"/>
                            </Border>
                            <ContentPresenter Margin="8,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Visibility" Value="Visible" TargetName="checkMark" />
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}" TargetName="checkBoxBorder" />
                                <Setter Property="Background" Value="#333333" TargetName="checkBoxBorder" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}" TargetName="checkBoxBorder" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Stile per TabControl -->
        <Style x:Key="ModernTabControlStyle" TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource BackgroundMediumBrush}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <!-- Stile per TabItem -->
        <Style x:Key="ModernTabItemStyle" TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="tabBorder" 
                                BorderThickness="0,0,0,3" 
                                BorderBrush="Transparent"
                                Margin="0,0,5,0"
                                Padding="15,10">
                            <ContentPresenter x:Name="contentPresenter" 
                                              ContentSource="Header" 
                                              HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}" TargetName="tabBorder"/>
                                <Setter Property="TextElement.Foreground" Value="{StaticResource TextPrimaryBrush}" TargetName="contentPresenter"/>
                                <Setter Property="TextElement.FontWeight" Value="Bold" TargetName="contentPresenter"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter Property="TextElement.Foreground" Value="{StaticResource TextSecondaryBrush}" TargetName="contentPresenter"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="TextElement.Foreground" Value="{StaticResource TextPrimaryBrush}" TargetName="contentPresenter"/>
                                <Setter Property="BorderBrush" Value="#777777" TargetName="tabBorder"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Stile per le card -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BackgroundLightBrush}" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="15" />
            <Setter Property="Margin" Value="0,0,0,15" />
            <!--<Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" Direction="315" 
                                     Opacity="0.2" ShadowDepth="1" Color="Black"/>
                </Setter.Value>
            </Setter>-->
        </Style>

        <!-- Converter per le risorse -->
        <local:MaterialToColorConverter x:Key="MaterialToColorConverter" />
    </Window.Resources>

    <!-- Layout principale con ombreggiatura -->
    <Grid>
        <!-- Ombra esterna -->
        <Border CornerRadius="12" Margin="5">
            <Border.Effect>
                <DropShadowEffect BlurRadius="15" Direction="315" 
                                 Opacity="0.4" ShadowDepth="3" Color="Black"/>
            </Border.Effect>
        </Border>

        <!-- Sistema di border annidati per gli angoli arrotondati corretti -->
        <Border x:Name="MainBorder" Background="{StaticResource PrimaryBrush}">
            <Border CornerRadius="11" Background="{StaticResource BackgroundDarkBrush}" Margin="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="40" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Barra titolo personalizzata -->
                    <Grid Grid.Row="0" Background="{StaticResource BackgroundDarkBrush}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Logo e titolo -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0,0,0">
                            <Image Source="/UltimaOnlineMacro;component/Assets/Images/icon.png" Width="30" Height="30" Margin="0,0,10,0" />
                            <TextBlock Text="UltimaOnlineMacro - Rotiniel Tools"
                                   Foreground="{StaticResource TextPrimaryBrush}" FontWeight="Bold" VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- Pulsanti controllo finestra -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,10,0">
                            <Button x:Name="MinimizeButton" Content="—" ToolTip="Minimizza" Click="MinimizeButton_Click" Style="{StaticResource TitleBarButtonStyle}" />
                            <Button x:Name="CloseButton" Content="✕" ToolTip="Chiudi" Click="CloseButton_Click" Style="{StaticResource CloseButtonStyle}" Margin="5,0,0,0" />
                        </StackPanel>
                    </Grid>

                    <!-- Contenuto principale -->
                    <TabControl Grid.Row="1" Margin="15,10" Background="Transparent" Style="{StaticResource ModernTabControlStyle}">
                        <TabControl.ItemContainerStyle>
                            <Style TargetType="TabItem" BasedOn="{StaticResource ModernTabItemStyle}" />
                        </TabControl.ItemContainerStyle>

                        <!-- Scheda Macro Principale -->
                        <TabItem Header="Macro Principale">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" >
                                <StackPanel Margin="5,10,20,5">
                                    <!-- Pannello Impostazioni Macro -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <StackPanel>

                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                                                <fa:ImageAwesome Icon="cog" Width="16" Height="16" Margin="0,0,8,0" Foreground="White"/>
                                                <TextBlock Text="Impostazioni Macro"
               Foreground="{StaticResource TextPrimaryBrush}" FontSize="20" FontWeight="Bold"/>
                                            </StackPanel>

                                            <!-- Tasto e Modificatori -->
                                            <Grid Margin="0,0,0,15">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="1*" />
                                                    <ColumnDefinition Width="1.5*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Selezione Tasto -->
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="Tasto" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold" Margin="0,0,0,8" />
                                                    <Border CornerRadius="6" BorderBrush="#555555" BorderThickness="1" Background="#2A2A30">
                                                        <Border.Effect>
                                                            <DropShadowEffect BlurRadius="5" Direction="315" 
                             Opacity="0.3" ShadowDepth="1" Color="Black"/>
                                                        </Border.Effect>
                                                        <ComboBox Name="cmbKey"  Height="32"
                  Background="#2A2A30" 
                  Foreground="White" 
                  FontSize="14" 
                  BorderThickness="0">
                                                            <!-- Definizione dello stile completo self-contained -->
                                                            <ComboBox.Style>
                                                                <Style TargetType="ComboBox">
                                                                    <Setter Property="Background" Value="#2A2A30"/>
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                    <Setter Property="BorderBrush" Value="#454545"/>
                                                                    <Setter Property="BorderThickness" Value="0"/>
                                                                    <Setter Property="Template">
                                                                        <Setter.Value>
                                                                            <ControlTemplate TargetType="ComboBox">
                                                                                <Grid>
                                                                                    <ToggleButton Name="ToggleButton"
                                                  Focusable="false"
                                                  IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                  ClickMode="Press">
                                                                                        <ToggleButton.Template>
                                                                                            <ControlTemplate TargetType="ToggleButton">
                                                                                                <Border Background="#2A2A30" CornerRadius="4">
                                                                                                    <Grid>
                                                                                                        <Grid.ColumnDefinitions>
                                                                                                            <ColumnDefinition Width="*"/>
                                                                                                            <ColumnDefinition Width="Auto"/>
                                                                                                        </Grid.ColumnDefinitions>
                                                                                                        <!-- Solo questo ContentPresenter -->
                                                                                                        <ContentPresenter Grid.Column="0"
                                                                          ContentSource="Content"
                                                                          Margin="10,0,0,0"
                                                                          HorizontalAlignment="Left"
                                                                          VerticalAlignment="Center"/>
                                                                                                        <Path Grid.Column="1"
                                                              Name="Arrow"
                                                              HorizontalAlignment="Center"
                                                              Width="10"
                                                              Height="6"
                                                              Margin="0,0,10,0"
                                                              VerticalAlignment="Center"
                                                              Data="M0,0 L10,0 L5,5 z"
                                                              Fill="White"/>
                                                                                                    </Grid>
                                                                                                </Border>
                                                                                                <ControlTemplate.Triggers>
                                                                                                    <Trigger Property="IsChecked" Value="True">
                                                                                                        <!-- Ruota la freccia quando aperta -->
                                                                                                        <Setter TargetName="Arrow" Property="Data" Value="M0,5 L10,5 L5,0 z"/>
                                                                                                    </Trigger>
                                                                                                </ControlTemplate.Triggers>
                                                                                            </ControlTemplate>
                                                                                        </ToggleButton.Template>
                                                                                        <ContentPresenter 
                                            Content="{Binding Path=SelectionBoxItem, RelativeSource={RelativeSource TemplatedParent}}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}">
                                                                                            <ContentPresenter.Resources>
                                                                                                <Style TargetType="TextBlock">
                                                                                                    <Setter Property="Foreground" Value="White"/>
                                                                                                </Style>
                                                                                            </ContentPresenter.Resources>
                                                                                        </ContentPresenter>
                                                                                    </ToggleButton>

                                                                                    <!-- Modificato il Popup per garantire la stessa larghezza -->
                                                                                    <Popup IsOpen="{Binding Path=IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                           Placement="Bottom"
                                           PlacementTarget="{Binding ElementName=ToggleButton}"
                                           Width="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}"
                                           AllowsTransparency="False">
                                                                                        <Border CornerRadius="0,0,4,4"
                                                BorderThickness="1"
                                                BorderBrush="#454545"
                                                Background="#2A2A30"
                                                Width="{Binding ActualWidth, ElementName=ToggleButton}"
                                                Effect="{StaticResource StandardShadow}">
                                                                                            <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                                                                                <StackPanel IsItemsHost="True"/>
                                                                                            </ScrollViewer>
                                                                                        </Border>
                                                                                    </Popup>
                                                                                </Grid>
                                                                            </ControlTemplate>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Style>
                                                            </ComboBox.Style>

                                                            <!-- Stile per gli elementi del ComboBox -->
                                                            <ComboBox.ItemContainerStyle>
                                                                <Style TargetType="ComboBoxItem">
                                                                    <Setter Property="Background" Value="#2A2A30" />
                                                                    <Setter Property="Foreground" Value="White" />
                                                                    <Setter Property="Padding" Value="8,4" />
                                                                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                                                                    <Setter Property="Width" Value="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ComboBox}}" />
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="#3E3E42" />
                                                                            <Setter Property="Foreground" Value="White" />
                                                                        </Trigger>
                                                                        <Trigger Property="IsSelected" Value="True">
                                                                            <Setter Property="Background" Value="#1E88E5" />
                                                                            <Setter Property="Foreground" Value="White" />
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </ComboBox.ItemContainerStyle>
                                                        </ComboBox>
                                                    </Border>
                                                </StackPanel>
                                                <!-- Modificatori -->
                                                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Bottom">
                                                    <CheckBox Name="chkCtrl" Content="Ctrl" Style="{StaticResource ModernCheckBoxStyle}" Margin="10,0" />
                                                    <CheckBox Name="chkAlt" Content="Alt" Style="{StaticResource ModernCheckBoxStyle}" Margin="10,0" />
                                                    <CheckBox Name="chkShift" Content="Shift" Style="{StaticResource ModernCheckBoxStyle}" Margin="10,0" />
                                                </StackPanel>
                                            </Grid>

                                            <!-- Delay ed Esecuzioni -->
                                            <Grid Margin="0,0,0,15">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="1*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Delay -->
                                                <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                                    <TextBlock Text="Delay (ms):" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold" Margin="0,0,0,8" />
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <Slider Name="sldDelay" Grid.Row="0" Minimum="2000" Maximum="10000" Value="4000"
                                                            TickFrequency="50" IsSnapToTickEnabled="True" />

                                                        <Grid Grid.Row="1">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Grid.Column="0" Text="2000" Foreground="#999999" FontSize="11"/>
                                                            <TextBlock Grid.Column="1" Text="{Binding ElementName=sldDelay, Path=Value, StringFormat={}{0:0} ms}" 
                                                                     Foreground="{StaticResource PrimaryBrush}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                                            <TextBlock Grid.Column="2" Text="10000" Foreground="#999999" FontSize="11"/>
                                                        </Grid>
                                                    </Grid>
                                                </StackPanel>

                                                <!-- Esecuzioni -->
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                    <TextBlock Text="Esecuzioni" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold" Margin="0,0,0,8" HorizontalAlignment="Center" />
                                                    <Border CornerRadius="6" Width="80" Height="40" Background="#2A2A30" BorderBrush="#454545" BorderThickness="1">
                                                        <TextBlock Name="txtRuns" Text="0" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Foreground="{StaticResource PrimaryBrush}" FontSize="18" FontWeight="Bold"/>
                                                    </Border>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Opzioni e Timer -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="1*" />
                                                    <ColumnDefinition Width="1*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Opzioni -->
                                                <StackPanel Grid.Column="0">
                                                    <CheckBox Name="chkMuloDaSoma" Content="Mulo da Soma" IsChecked="True" Style="{StaticResource ModernCheckBoxStyle}" Margin="0,5" />
                                                    <CheckBox Name="chkLamaPortatore" Content="Lama portatore" IsChecked="False" Style="{StaticResource ModernCheckBoxStyle}" Margin="0,5" />
                                                    <CheckBox Name="chkFuria" Content="AutoFuria" IsEnabled="false" IsChecked="False" Style="{StaticResource ModernCheckBoxStyle}" Margin="0,5" />
                                                </StackPanel>

                                                <!-- Timer -->
                                                <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="10,0,0,0" Background="#2A2A30">
                                                    <StackPanel HorizontalAlignment="Center">
                                                        <TextBlock Text="Tempo Trascorso" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,0,0,5" />
                                                        <TextBlock Name="lblElapsed" Text="00:00:00" Foreground="#00E676" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" />
                                                    </StackPanel>
                                                </Border>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- Pulsanti START/STOP -->
                                    <Grid Margin="0,15,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="1*" />
                                        </Grid.ColumnDefinitions>

                                        <Button Name="btnRun" Grid.Column="0" Width="170" Height="50"
        Click="Run_Click" Style="{StaticResource MyButtonStyle}" Background="#00C853" HorizontalAlignment="Center">
                                            <fa:ImageAwesome Icon="Play" Width="16" Height="16" Margin="0,0,5,0" Foreground="White"/>
                                            <Button.Resources>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#00B248"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Resources>
                                        </Button>

                                        <Button Name="btnStop" Grid.Column="1"  Width="170" Height="50"
        Click="Stop_Click" Style="{StaticResource MyButtonStyle}" Background="#E53935" HorizontalAlignment="Center">
                                            <fa:ImageAwesome Icon="Stop" Width="16" Height="16" Margin="0,0,5,0" Foreground="White"/>
                                            <Button.Resources>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#D32F2F"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Resources>
                                        </Button>

                                        <!-- Bottone Aggiunto -->
                                        <Button Name="btnRefreshScreen" Grid.Column="2" Width="170" Height="50"
        Click="RefreshScreen_Click" Style="{StaticResource MyButtonStyle}" Background="#FF9800" HorizontalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <fa:ImageAwesome Icon="Refresh" Width="16" Height="16" Margin="0,0,5,0" Foreground="White"/>
                                            </StackPanel>
                                            <Button.Resources>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#FB8C00"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Resources>
                                        </Button>
                                    </Grid>

                                    <!-- Log di sistema -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Intestazione espandibile -->
                                            <Grid Grid.Row="0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" Text="Log di Sistema" Foreground="{StaticResource TextPrimaryBrush}" 
                   FontWeight="SemiBold" Margin="0,0,0,8"/>

                                                <ToggleButton x:Name="toggleLogVisibility" Grid.Column="1" Content="▼" Width="26" Height="26"
                      IsChecked="False" Background="Transparent" BorderThickness="0" 
                      Foreground="{StaticResource TextPrimaryBrush}"
                      VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <ToggleButton.Style>
                                                        <Style TargetType="ToggleButton">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="ToggleButton">
                                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                                        </Border>
                                                                        <ControlTemplate.Triggers>
                                                                            <Trigger Property="IsChecked" Value="False">
                                                                                <Setter Property="Content" Value="▶" />
                                                                            </Trigger>
                                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                                <Setter Property="Background" Value="#3E3E42" />
                                                                            </Trigger>
                                                                        </ControlTemplate.Triggers>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>
                                            </Grid>

                                            <!-- Contenuto del log espandibile -->
                                            <Border Grid.Row="1" Background="#1A1A1A" CornerRadius="6" BorderBrush="#454545" BorderThickness="1"
            Height="180" Visibility="{Binding IsChecked, ElementName=toggleLogVisibility, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                                    <TextBox Name="txtLog" IsReadOnly="True" TextWrapping="Wrap"
                   Background="Transparent" Foreground="#CCCCCC" BorderThickness="0" 
                   FontFamily="Consolas" FontSize="13" Padding="10" />
                                                </ScrollViewer>
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <!-- Footer -->
                                    <TextBlock Text="UltimaOnlineMacro - Rotiniel Tools v1.0" HorizontalAlignment="Right" 
                                           Foreground="{StaticResource TextSecondaryBrush}" Margin="0,10,5,5" FontSize="11" />
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Scheda Regions (mantenuta nell'ordine originale) -->
                        <TabItem Header="Regioni">
                            <Border Style="{StaticResource CardStyle}" Margin="5,10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                                        <fa:ImageAwesome Icon="WindowRestore" Width="16" Height="16" Margin="0,0,8,0" Foreground="White"/>
                                        <TextBlock Grid.Row="0" Text="Configurazione Regioni UI" 
                                               Foreground="{StaticResource TextPrimaryBrush}" FontSize="20" FontWeight="Bold"
                                               Margin="0,0,0,0" HorizontalAlignment="Center" />
                                    </StackPanel>

                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="1*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Colonna sinistra -->
                                        <StackPanel Grid.Column="0" Orientation="Vertical" HorizontalAlignment="Center">
                                            <Button Name="btnSelectBackpack" Content="Seleziona Zaino" 
                                                    Click="SelectBackpackRegion_Click" Style="{StaticResource MyButtonStyle}">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="🎒" FontSize="18" Margin="0,0,10,0"/>
                                                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>

                                            <Button Name="btnSelectPaperdoll" Content="Seleziona Paperdoll" 
                                                    Click="SelectPaperdoll_Click" Style="{StaticResource MyButtonStyle}" Margin="10,20">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="👤" FontSize="18" Margin="0,0,10,0"/>
                                                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>

                                            <Button Name="btnSelectStatus" Content="Seleziona Status" 
                                                    Click="SelectStatus_Click" Style="{StaticResource MyButtonStyle}">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="📊" FontSize="18" Margin="0,0,10,0"/>
                                                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>
                                        </StackPanel>

                                        <!-- Colonna destra -->
                                        <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center">
                                            <Button Name="btnSelectFood" Content="Seleziona Cibo" 
                                                    Click="SelectFood_Click" Style="{StaticResource MyButtonStyle}">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="🍗" FontSize="18" Margin="0,0,10,0"/>
                                                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>

                                            <Button Name="btnSelectWater" Content="Seleziona Acqua" 
                                                    Click="SelectWater_Click" Style="{StaticResource MyButtonStyle}" Margin="10,20">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="💧" FontSize="18" Margin="0,0,10,0"/>
                                                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </Border>
                        </TabItem>
                        <!-- Scheda Risorse da aggiungere al TabControl -->
                        <TabItem Header="Risorse">
                            <TabControl ItemsSource="{Binding Muli}" Style="{StaticResource ModernTabControlStyle}">
                                <!-- Intestazione di ciascuna sottoscheda: nome del mulo -->
                                <TabControl.ItemContainerStyle>
                                    <Style TargetType="TabItem" BasedOn="{StaticResource ModernTabItemStyle}" />
                                </TabControl.ItemContainerStyle>

                                <TabControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </TabControl.ItemTemplate>

                                <!-- Contenuto di ciascuna sottoscheda -->
                                <TabControl.ContentTemplate>
                                    <DataTemplate>
                                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="5">
                                            <Border Style="{StaticResource CardStyle}" Margin="0,5">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                                                        <fa:ImageAwesome Icon="Sitemap" Width="16" Height="16" Margin="0,0,8,0" Foreground="White"/>
                                                        <TextBlock Text="Risorse Raccolte" Foreground="{StaticResource TextPrimaryBrush}" 
                                        FontSize="18" FontWeight="Bold" Margin="0,0,0,0" HorizontalAlignment="Center" />
                                                    </StackPanel>

                                                    <!-- Barra di progresso per ActualOre / MaxOre -->
                                                    <TextBlock Text="Carico attuale:" Margin="0,0,0,5" HorizontalAlignment="Center" Foreground="{StaticResource TextPrimaryBrush}" />
                                                    <ProgressBar Minimum="0" Maximum="800" Value="{Binding ActualOre, Mode=OneWay}" 
                                        Height="16" Margin="10,0,10,15" Background="#2A2A30" Foreground="{StaticResource PrimaryBrush}" />

                                                    <!-- Elenco delle risorse del mulo con layout migliorato -->
                                                    <ItemsControl ItemsSource="{Binding RisorseQuantita}">
                                                        <!-- Layout con WrapPanel migliorato -->
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <WrapPanel IsItemsHost="True" Orientation="Horizontal" HorizontalAlignment="Center" />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>

                                                        <!-- Template per ogni elemento risorsa -->
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Width="130" Height="90" BorderThickness="1" CornerRadius="6" Margin="5" 
                                              BorderBrush="{Binding Risorsa, Converter={StaticResource MaterialToColorConverter}}">
                                                                    <Border.Background>
                                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                            <GradientStop Color="#FF3E3E42" Offset="0.0"/>
                                                                            <GradientStop Color="#FF2A2A34" Offset="1.0"/>
                                                                        </LinearGradientBrush>
                                                                    </Border.Background>
                                                                    <Grid>
                                                                        <Grid.RowDefinitions>
                                                                            <RowDefinition Height="Auto"/>
                                                                            <RowDefinition Height="*"/>
                                                                        </Grid.RowDefinitions>

                                                                        <!-- Nome risorsa -->
                                                                        <TextBlock Text="{Binding Risorsa}" FontSize="12" FontWeight="SemiBold" 
                                                        Foreground="White" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" 
                                                        MaxHeight="36" VerticalAlignment="Top" HorizontalAlignment="Center"
                                                        Margin="5,8,5,0" />

                                                                        <!-- Valore risorsa -->
                                                                        <TextBlock Grid.Row="1" Text="{Binding QuantitaGrezza}" FontSize="22" 
                                                        FontWeight="Bold" Foreground="White" 
                                                        HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </ScrollViewer>
                                    </DataTemplate>
                                </TabControl.ContentTemplate>
                            </TabControl>
                        </TabItem>
                        <!-- Scheda Settings -->
                        <TabItem Header="Impostazioni">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <Border Style="{StaticResource CardStyle}" Margin="5,10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                                            <fa:ImageAwesome Icon="Wrench" Width="16" Height="16" Margin="0,0,8,0" Foreground="White"/>
                                            <TextBlock Grid.Row="0" Text="Impostazioni Avanzate" 
                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="20" FontWeight="Bold"
                       Margin="0,0,0,0" HorizontalAlignment="Center" />
                                        </StackPanel>

                                        <!-- Journal Configuration -->
                                        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Background="#2A2A30" Padding="15">
                                            <StackPanel>
                                                <TextBlock Text="Configurazione Journal" 
                               Foreground="{StaticResource TextPrimaryBrush}" FontSize="16" FontWeight="SemiBold"
                               Margin="0,0,0,10" HorizontalAlignment="Center" />

                                                <Border Background="#1A1A1A" CornerRadius="6" Padding="10" Margin="0,0,0,15">
                                                    <TextBlock Text="Generalmente contenuto dentro The Miracle\Data\Profiles\nomeaccount\The Miracle DC\nomepg" 
                                   Foreground="{StaticResource TextSecondaryBrush}" TextWrapping="Wrap" />
                                                </Border>

                                                <Button Content="Seleziona File Macro" Click="SelectFileMacro_Click" Width="220" Height="45" Style="{StaticResource MyButtonStyle}">
                                                    <Button.ContentTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="📁" FontSize="18" Margin="0,0,10,0"/>
                                                                <TextBlock Text="Seleziona File Macro" VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </Button.ContentTemplate>
                                                </Button>


                                                <Border Background="#1A1A1A" CornerRadius="6" Padding="12" Margin="0,15,0,0" BorderBrush="#454545" BorderThickness="1">
                                                    <TextBlock Name="SelectedFilePathText" TextWrapping="Wrap" FontWeight="SemiBold" Foreground="#4CAF50" />
                                                </Border>
                                            </StackPanel>
                                        </Border>

                                        <!-- Audio Controls -->
                                        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Background="#2A2A30" Margin="0,15,0,0" Padding="15">
                                            <StackPanel>
                                                <TextBlock Text="Controlli Audio" 
                               Foreground="{StaticResource TextPrimaryBrush}" FontSize="16" FontWeight="SemiBold"
                               Margin="0,0,0,15" HorizontalAlignment="Center" />

                                                <Button Name="btnStopSound" Content="Stop Beep" Style="{StaticResource MyButtonStyle}" Background="#FF5722"
                            Click="StopBeep_Click" Width="200" Height="45" HorizontalAlignment="Center">
                                                    <Button.ContentTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="🔇" FontSize="18" Margin="0,0,10,0"/>
                                                                <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </Button.ContentTemplate>
                                                    <Button.Resources>
                                                        <Style TargetType="Border">
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#D84315"/>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Resources>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Scheda Test (mantenuta nell'ordine originale) -->
                        <TabItem Header="Test">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <Border Style="{StaticResource CardStyle}" Margin="5,10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                                            <fa:ImageAwesome Icon="Flask" Width="16" Height="16" Margin="0,0,8,0" Foreground="White"/>
                                            <TextBlock Grid.Row="0" Text="Strumenti di Test" 
                                               Foreground="{StaticResource TextPrimaryBrush}" FontSize="20" FontWeight="Bold"
                                               Margin="0,0,0,0" HorizontalAlignment="Center" />
                                        </StackPanel>

                                        <!-- Test Buttons Section -->
                                        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Background="#2A2A30" Padding="15">
                                            <StackPanel>
                                                <TextBlock Text="Test Input/Output" 
                                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="16" FontWeight="SemiBold"
                                                       Margin="0,0,0,15" HorizontalAlignment="Center" />

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="1*" />
                                                        <ColumnDefinition Width="1*" />
                                                    </Grid.ColumnDefinitions>

                                                    <Button Name="btnTestMouseInput" Grid.Column="0" Content="Test Mouse" Width="170" Height="50"
                                                        Click="TestMouse_Click" Style="{StaticResource MyButtonStyle}" Background="#9C27B0" HorizontalAlignment="Center">
                                                        <Button.ContentTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="🖱️" FontSize="18" Margin="0,0,10,0"/>
                                                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </Button.ContentTemplate>
                                                        <Button.Resources>
                                                            <Style TargetType="Border">
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="#7B1FA2"/>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Resources>
                                                    </Button>

                                                    <Button Name="btnTestKeyboardMessage" Grid.Column="1" Content="Test Tastiera" Width="170" Height="50"
                                                        Click="TestKeyboard_Click" Style="{StaticResource MyButtonStyle}" Background="#FF9800" HorizontalAlignment="Center">
                                                        <Button.ContentTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="⌨️" FontSize="18" Margin="0,0,10,0"/>
                                                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </Button.ContentTemplate>
                                                        <Button.Resources>
                                                            <Style TargetType="Border">
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="#F57C00"/>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Resources>
                                                    </Button>
                                                </Grid>
                                            </StackPanel>
                                        </Border>

                                        <!-- Test Results Section -->
                                        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Background="#2A2A30" Margin="0,15,0,0" Padding="15">
                                            <StackPanel>
                                                <TextBlock Text="Risultati Test" 
                                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="16" FontWeight="SemiBold"
                                                       Margin="0,0,0,10" HorizontalAlignment="Center" />

                                                <Border Background="#1A1A1A" CornerRadius="6" Padding="12" BorderBrush="#454545" BorderThickness="1" MinHeight="120">
                                                    <TextBlock Name="TestResultsText" Foreground="{StaticResource TextPrimaryBrush}" 
                                                           TextWrapping="Wrap" FontFamily="Consolas" />
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Border>
        </Border>
    </Grid>
</Window>

